<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ç§Ÿé‡‘æ¯”ä¾‹è©¦ç®—</title>
  <style>
    body, html {
      height: 100%;
      margin: 0;
      font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #f5f5f5;
    }

    #container {
      background: white;
      padding: 15px 55px;
      border-radius: 8px;
      box-shadow: 0 0 12px rgb(0 0 0 / 0.1);
      max-width: 900px;
      width: 100%;
      box-sizing: border-box;
      position: relative;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    form {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 10px;
    }

    .form-row {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin: 5px 0;
      width: 350px;
    }

    label {
      width: 120px;
      font-weight: bold;
      text-align: left;
      margin-right: 15px;
      user-select: none;
      white-space: nowrap;
    }

    input {
      width: 200px;
      padding: 5px 8px;
      font-size: 14px;
      box-sizing: border-box;
    }

    #buttonGroup {
      margin: 10px 0 15px 0;
      text-align: center;
    }

    button {
      padding: 8px 20px;
      margin: 0 10px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      background-color: #6C6C6C;
      color: white;
      transition: background-color 0.3s ease, transform 0.2s ease;
      position: relative;
      z-index: 1;
    }

    button:hover {
      background-color: #005A9E;
    }

    .magnetic {
      will-change: transform;
    }

    #outputWrapper {
      display: flex;
      gap: 20px;
      justify-content: center;
    }

    textarea#calcResult,
    textarea#emailBody {
      width: 250px;
      height: 250px;
      font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
      font-size: 14px;
      font-weight: bold;
      white-space: pre-wrap;
      resize: vertical;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #htmlContent {
      display: none;
    }

    #footerNote {
      position: fixed;
      bottom: 8px;
      right: 10px;
      font-size: 7px;
      font-weight: bold;
      color: #3C3C3C;
      font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
    }
  </style>
</head>
<body>

<div id="container">
  <h2>ç§Ÿé‡‘æ¯”ä¾‹è©¦ç®—</h2>

  <form id="rentForm" onsubmit="event.preventDefault();">
    <div class="form-row">
      <label for="year">è¥¿å…ƒå¹´ï¼š</label>
      <input type="number" id="year" min="2018" max="2100" />
    </div>

    <div class="form-row">
      <label for="month">æœˆï¼š</label>
      <input type="number" id="month" min="1" max="12" />
    </div>

    <div class="form-row">
      <label for="day">æ—¥ï¼š</label>
      <input type="number" id="day" min="1" max="31" />
    </div>

    <div class="form-row">
      <label for="rent">å–®å°ç§Ÿé‡‘ï¼š</label>
      <input type="number" id="rent" min="0" step="1" />
    </div>

    <div class="form-row">
      <label for="units">å°æ•¸ï¼š</label>
      <input type="number" id="units" min="1" />
    </div>
  </form>

  <div id="buttonGroup">
    <button id="calcBtn" class="magnetic" onclick="if(isValidInputs()){generateTemplate();} return false;">è¨ˆç®—ï¼ˆè£œåŒ¯ï¼‰â•</button>
    <button id="rebateBtn" class="magnetic" onclick="if(isValidInputs()){generateRebateTemplate();} return false;">è¨ˆç®—ï¼ˆå›æ‰£ï¼‰â–</button>
    <button id="copyBtn" class="magnetic" onclick="copyEmailOnly(); return false;">è¤‡è£½ ğŸ“‹</button>
    <button onclick="clearAll(); return false;">æ¸…é™¤ ğŸ§¹</button>
  </div>

  <div id="outputWrapper">
    <div>
      <h3>ğŸ“ è¨ˆç®—å…¬å¼çµæœï¼š</h3>
      <textarea id="calcResult" readonly></textarea>
    </div>
    <div>
      <h3>ğŸ“ ä¿¡ä»¶å…§å®¹ç”¢å‡ºï¼š</h3>
      <textarea id="emailBody" readonly></textarea>
    </div>
  </div>
  <div id="htmlContent"></div>
</div>
<div id="footerNote">20250606 #SummerChung</div>

<script>
function isValidInputs() {
  const year = document.getElementById('year').value;
  const month = document.getElementById('month').value;
  const day = document.getElementById('day').value;
  const rent = document.getElementById('rent').value;
  const units = document.getElementById('units').value;
  return year && month && day && rent && units;
}

function isLeapYear(year) {
  return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
}

function getMonthDays(year, month) {
  if ([1, 3, 5, 7, 8, 10, 12].includes(month)) return 31;
  if ([4, 6, 9, 11].includes(month)) return 30;
  return isLeapYear(year) ? 29 : 28;
}

function toROCDate(year, month, day) {
  return `${year - 1911}/${String(month).padStart(2, '0')}/${String(day).padStart(2, '0')}`;
}

function generateEmailContent(rawText) {
  const html = rawText
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/\n/g, "<br>")
    .replace(/ /g, "&nbsp;");
  return `<span style="font-family: å¾®è»Ÿæ­£é»‘é«”; font-size:11pt; font-weight:bold;">${html}</span>`;
}

function generateTemplate() {
  const y = parseInt(document.getElementById('year').value);
  const m = parseInt(document.getElementById('month').value);
  const d = parseInt(document.getElementById('day').value);
  const rent = parseInt(document.getElementById('rent').value);
  const units = parseInt(document.getElementById('units').value);

  const monthDays = getMonthDays(y, m);
  const rentDays = monthDays - d + 1;
  const totalRent = ((rent / monthDays) * rentDays * units).toFixed(0);

  const formula = `$${rent} Ã· ${monthDays} Ã— ${rentDays} Ã— ${units} = $${totalRent}`;

  const rawText =
`Dear Allï¼š

å¤§æ¨“åç¨±ï¼š
åœ°å€ï¼š
åˆç´„æœŸé–“ï¼š
æ›æ©Ÿé–‹æ’­æ—¥æœŸï¼š${toROCDate(y, m, d)}
å–®å°ç§Ÿé‡‘ï¼š${rent}
å¯¦éš›æ›æ©Ÿå°æ•¸ï¼š${units}
å‚™è¨»ï¼š${formula}`;

  document.getElementById('calcResult').value = formula;
  document.getElementById('emailBody').value = rawText;

  window._emailHtml = generateEmailContent(rawText);
}

function generateRebateTemplate() {
  const y = parseInt(document.getElementById('year').value);
  const m = parseInt(document.getElementById('month').value);
  const d = parseInt(document.getElementById('day').value);
  const rent = parseInt(document.getElementById('rent').value);
  const units = parseInt(document.getElementById('units').value);

  const rebateDays = d;
  const monthDays = getMonthDays(y, m);
  const totalRebate = ((rent / monthDays) * rebateDays * units).toFixed(0);

  const formula = `$${rent} Ã· ${monthDays} Ã— ${rebateDays} Ã— ${units} = $${totalRebate}`;

  const rawText =
`Dear Allï¼š

å¤§æ¨“åç¨±ï¼š
åœ°å€ï¼š
åˆç´„æœŸé–“ï¼š
æ‹†æ©Ÿæ—¥æœŸï¼š${toROCDate(y, m, d)}
å–®å°ç§Ÿé‡‘ï¼š${rent}
æ‹†æ©Ÿå°æ•¸ï¼š${units}
å‚™è¨»ï¼š${formula}`;

  document.getElementById('calcResult').value = `${formula}`;
  document.getElementById('emailBody').value = rawText;

  window._emailHtml = generateEmailContent(rawText);
}

function copyEmailOnly() {
  if (!window._emailHtml) {
    alert('è«‹å…ˆå®Œæˆè¨ˆç®—ï¼Œæ‰èƒ½è¤‡è£½ä¿¡ä»¶å…§å®¹');
    return;
  }

  navigator.clipboard.write([
    new ClipboardItem({
      "text/html": new Blob([window._emailHtml], { type: "text/html" }),
      "text/plain": new Blob([document.getElementById('emailBody').value], { type: "text/plain" }),
    })
  ]).then(() => {
    alert('ä¿¡ä»¶å…§å®¹å·²è¤‡è£½ï¼Œå¯ä»¥ç›´æ¥è²¼åˆ°Outlookäº†ï¼');
  }, () => {
    alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½å…§å®¹');
  });
}

function clearAll() {
  ['year','month','day','rent','units','calcResult','emailBody'].forEach(id => {
    const el = document.getElementById(id);
    if(el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.value = '';
  });
  window._emailHtml = null;
}

// ==== ç£éµæ’æ–¥æ•ˆæœï¼Œèª¿æ•´è§¸ç™¼ç¯„åœç‚º150pxï¼Œè·é›¢è¶Šè¿‘æ’æ–¥è¶Šå¤§ ====

document.querySelectorAll('.magnetic').forEach(btn => {
  btn.addEventListener('mousemove', e => {
    if (!isValidInputs()) {
      const rect = btn.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const distX = e.clientX - centerX;
      const distY = e.clientY - centerY;
      const distance = Math.sqrt(distX * distX + distY * distY);

      const triggerDistance = 330; // è§¸ç™¼ç¯„åœï¼Œè·é›¢å°æ–¼æ­¤å€¼é–‹å§‹æ’æ–¥
      if (distance < triggerDistance) {
        const strength = (triggerDistance - distance) / triggerDistance; // 0~1
        const moveX = -distX * strength * 3.9;
        const moveY = -distY * strength * 3.9;
        btn.style.transform = `translate(${moveX}px, ${moveY}px)`;
      } else {
        btn.style.transform = '';
      }
    } else {
      btn.style.transform = '';
    }
  });

  btn.addEventListener('mouseleave', () => {
    btn.style.transform = '';
  });
});
</script>

</body>
</html>
